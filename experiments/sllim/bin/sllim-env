#!/bin/sh

# This script should work on systems with shells other than Bash (Dash, Busybox
# Ash, etc.) and with optional programs missing (such as "which").

set -eu

realdir() {
  cd "$1"
  pwd -P
}

# Add this script's directory to PATH, if it isn't there already.
SLLIM_PATH="$(realdir "$(dirname "$0")")"
if ! command -v sllim-env >/dev/null 2>&1; then
  export PATH="$SLLIM_PATH${PATH:+:${PATH}}"
fi

export ENV="$SLLIM_PATH/sllim-env.sh"

SHELL="${SHELL-bash}"
if "$SHELL" --rcfile /dev/null -c true >/dev/null 2>&1; then
  # bash may ignore ENV, so we have to use --rcfile instead.
  exec "$SHELL" --rcfile "$ENV"
else
  # BusyBox ash, dash, and bash (in sh mode) all use ENV.
  exec "$SHELL"
fi
