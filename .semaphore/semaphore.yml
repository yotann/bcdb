version: v1.0
name: BCDB
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
execution_time_limit:
  hours: 3

blocks:
  - name: "Build and test"
    task:
      secrets:
        - name: bcdb-cachix
      jobs:
        - name: Build
          commands:
            - checkout
            - .semaphore/install-nix-and-cachix.sh
            - . ~/.nix-profile/etc/profile.d/nix.sh
            - .semaphore/build-deps.sh
            - nix-build -A $A
          matrix:
            - env_var: A
              values:
                - bcdb-llvm5
                - bcdb-llvm6
                - bcdb-llvm7
                - bcdb-llvm8
                - bcdb-llvm9
                - bcdb-llvm10
                - bcdb-clang
